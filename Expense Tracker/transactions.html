<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Transactions</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

</head>
<body class="bg-gray-100">

<div class="max-w-3xl mx-auto p-6 space-y-6">

  <div class="rounded-2xl bg-gradient-to-r from-emerald-600 to-emerald-400 p-6 shadow-md text-white">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <div>
        <h1 class="text-3xl font-bold">Transactions</h1>
        <p class="text-emerald-100 text-sm mt-1">Track all your income and expenses in one place.</p>
      </div>

      <div id="countBox" class="bg-white/10 backdrop-blur-md px-4 py-2 rounded-lg text-sm font-medium"></div>
    </div>

    <div class="mt-6 flex flex-col md:flex-row gap-3">
      <div class="relative flex-1">
        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-white/70"></i>
        <input id="searchInput"
          type="text"
          placeholder="Search category or notes..."
          class="w-full bg-white/15 text-white placeholder-white/60 pl-10 pr-4 py-2 rounded-lg outline-none" />
      </div>

      <div class="flex gap-2">
        <button class="filter-btn bg-white text-emerald-700 shadow-md px-4 py-2 rounded-lg" data-type="all">All</button>
        <button class="filter-btn bg-white/20 text-white/80 hover:bg-white/30 px-4 py-2 rounded-lg" data-type="income">Income</button>
        <button class="filter-btn bg-white/20 text-white/80 hover:bg-white/30 px-4 py-2 rounded-lg" data-type="expense">Expense</button>
      </div>
    </div>
  </div>

  <div id="transactionsContainer" class="space-y-8"></div>

</div>

<script>
let transactions = JSON.parse(localStorage.getItem("transactions") || "[]");

let filterType = "all";
let searchTerm = "";

const container = document.getElementById("transactionsContainer");
const searchInput = document.getElementById("searchInput");
const countBox = document.getElementById("countBox");
const filterButtons = document.querySelectorAll(".filter-btn");

filterButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    filterButtons.forEach(b => b.className = "filter-btn bg-white/20 text-white/80 px-4 py-2 rounded-lg");
    
    btn.className = "filter-btn bg-white text-emerald-700 shadow-md px-4 py-2 rounded-lg";
    filterType = btn.dataset.type;
    render();
  });
});

searchInput.addEventListener("input", e => {
  searchTerm = e.target.value.toLowerCase();
  render();
});

function deleteTransaction(id) {
  transactions = transactions.filter(t => t.id !== id);
  localStorage.setItem("transactions", JSON.stringify(transactions));
  render();
}

function groupByDate(list) {
  const groups = {};
  list.forEach(t => {
    if (!groups[t.date]) groups[t.date] = [];
    groups[t.date].push(t);
  });
  return Object.entries(groups).sort((a, b) => new Date(b[0]) - new Date(a[0]));
}

function render() {
  let list = [...transactions];

  if (filterType !== "all") list = list.filter(t => t.type === filterType);

  if (searchTerm) {
    list = list.filter(
      t =>
        t.category.toLowerCase().includes(searchTerm) ||
        (t.notes || "").toLowerCase().includes(searchTerm)
    );
  }

  countBox.textContent = `${list.length} transaction${list.length !== 1 ? "s" : ""}`;
  container.innerHTML = "";

  const grouped = groupByDate(list);

  if (grouped.length === 0) {
    container.innerHTML = `
      <div class="text-center bg-white rounded-2xl border border-slate-200 shadow-sm py-16">
        <p class="text-slate-500 text-lg font-medium">No transactions found</p>
        <p class="text-slate-400 text-sm mt-2">Try adjusting your filters</p>
      </div>`;
    return;
  }

  grouped.forEach(([date, items]) => {
    const dateHeading = new Date(date).toLocaleDateString("en-US", {
      weekday: "long", month: "long", day: "numeric", year: "numeric"
    });

    let html = `
      <div class="space-y-3">
        <div class="flex items-center gap-2 text-slate-500 font-medium">
          <i data-lucide="calendar"></i>
          ${dateHeading}
        </div>
        <div class="grid gap-3">
    `;

    items.forEach(t => {
      html += `
        <div class="flex items-center justify-between bg-white rounded-xl shadow-sm border border-slate-200 p-4">
          <div class="flex items-center gap-4 flex-1">
            <div class="w-10 h-10 flex items-center justify-center rounded-full ${
              t.type === "income" ? "bg-emerald-100 text-emerald-600" : "bg-red-100 text-red-600"
            }">${t.type === "income" ? "+" : "-"}</div>

            <div class="flex-1 min-w-0">
              <p class="font-semibold text-slate-800 truncate max-w-[180px]">${t.category}</p>
              ${t.notes ? `<p class="text-sm text-slate-500 mt-1 max-w-xs">${t.notes}</p>` : ""}
            </div>
          </div>

          <div class="flex items-center gap-4">
            <p class="text-lg font-bold ${
              t.type === "income" ? "text-emerald-600" : "text-red-600"
            }">${t.type === "income" ? "+" : "-"}â‚¹${t.amount.toFixed(2)}</p>

            <button onclick="deleteTransaction('${t.id}')" class="p-2 text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-lg">
              <i data-lucide="trash-2"></i>
            </button>
          </div>
        </div>
      `;
    });

    html += `</div></div>`;
    container.insertAdjacentHTML("beforeend", html);
  });

  lucide.createIcons();
}

render();
lucide.createIcons();
</script>

</body>
</html>